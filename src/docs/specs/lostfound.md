# 분실물 관리 (Lost & Found)

분실물 관리는 세차 과정에서 발견된 고객의 분실물을 등록, 추적, 처리하는 기능입니다. 옥스트라(Oxtra) 시스템의 '분실물 카드'와 연동하여 고객에게 분실물을 안전하게 인계하는 것을 목표로 합니다.

---

## 1. 데이터 모델 (Data Model)

분실물 정보를 구성하는 데이터 필드는 다음과 같습니다.

| 필드명 (영문) | 필드명 (국문) | 데이터 타입 | 설명 | 수정 가능 |
| :--- | :--- | :--- | :--- | :--- |
| `id` | 분실물 ID | Number | 시스템에서 자동 생성되는 고유 식별자 | 불가 |
| `createdAt` | 접수 일시 | Datetime | 분실물이 시스템에 처음 등록된 시간 | 불가 |
| `itemCategory` | 분실물 구분 | String | `'일반'` 또는 `'귀중품'` | **가능** |
| `status` | 처리 상태 | String | 아래 [처리 상태](#2-처리-상태-정의) 참조 | **가능** |
| `itemDetails` | 습득물 상세 정보 | String | 습득한 분실물의 구체적인 정보 (예: 검은색 아이폰 13) | **가능** |
| `itemPhotos` | 습득물 사진 | Array | 분실물 사진 URL 목록 | **가능** |
| `carId` | 차량 ID | Number | 분실물이 발견된 차량의 고유 ID | 불가 |
| `carNumber` | 차량 번호 | String | 분실물이 발견된 차량의 번호 | 불가 |
| `zoneId` | 존 ID | Number | 차량이 소속된 존의 고유 ID | 불가 |
| `zoneName` | 존 이름 | String | 존 명칭 (예: 성수 비즈밸리) | 불가 |
| `region1` | 지역1 | String | 존의 상위 지역 (예: 서울) | 불가 |
| `region2` | 지역2 | String | 존의 하위 지역 (예: 성동구) | 불가 |
| `partnerId` | 파트너 ID | Number | 세차를 수행한 파트너의 고유 ID | 불가 |
| `partnerName` | 파트너 이름 | String | 파트너 명칭 | 불가 |
| `relatedOrderId` | 연계 오더 ID | Number | 분실물이 발견된 세차 오더의 ID | **가능** |
| `lostItemCardReceiptNumber` | 분실물 카드 접수 번호 | String | 옥스트라 시스템과 연동되는 접수 번호 | 불가 |
| `deliveryAddress1` | 배송 주소1 | String | 배송지 기본 주소 (도로명 또는 지번) | **가능** |
| `deliveryAddress2` | 배송 주소2 | String | 배송지 상세 주소 | **가능** |

---

## 2. 처리 상태 정의 (Status Definition)

### 2.1 상태 목록

| 상태명 | UI Badge | 설명 |
| :--- | :--- | :--- |
| **배송지 미입력** | `warn` (황색) | 분실물은 등록되었으나, 고객의 배송지 정보가 아직 입력되지 않은 상태입니다. |
| **발송 대기** | `info` (청색) | 고객의 배송지가 입력되어 발송을 기다리는 상태입니다. (일반만 해당) |
| **발송 완료** | `ok` (녹색) | 고객에게 분실물 배송이 완료된 상태입니다. (일반만 해당) |
| **경찰서 인계** | `default` (회색) | 분실물을 관할 경찰서에 인계한 상태입니다. (귀중품만 해당) |
| **폐기 완료** | `default` (회색) | 보관 기간이 만료되어 규정에 따라 분실물을 폐기한 상태입니다. |

### 2.2 구분별 상태 흐름

분실물 구분에 따라 유효한 상태와 전이 흐름이 다릅니다.

**일반:**
- 유효 상태: `배송지 미입력` → `발송 대기` → `발송 완료` // 또는 `폐기 완료`
- 배송 주소(주소1) 입력·저장 시 `배송지 미입력` → `발송 대기` 자동 전이

**귀중품:**
- 유효 상태: `배송지 미입력` → `경찰서 인계` // 또는 `폐기 완료`

### 2.3 종결 상태

`발송 완료`, `경찰서 인계`, `폐기 완료`는 종결 상태입니다.
- 종결 상태에서는 분실물 구분·처리 상태 Select가 비활성화되며, 텍스트/Badge로만 표시됩니다.
- 배송 주소도 읽기 전용으로 표시됩니다.

### 2.4 구분 변경 시 상태 리셋

- 구분 변경 시 현재 상태가 새 구분의 유효 상태 목록에 없으면 `'배송지 미입력'`으로 자동 리셋됩니다.
- 컨펌 메시지에 상태 초기화 안내가 포함됩니다.

---

## 3. 미션 연동 로직 (Mission Integration)

- 세차 수행 전, 해당 차량(`car_id`)에 고객이 신고한 '분실물 카드'가 옥스트라 시스템에 존재하는 경우, 해당 세차 오더에 **'분실물 수거' 미션이 자동으로 등록**됩니다.
- 핸들러는 이 미션을 확인하고, 세차 시 분실물 수거에 더욱 주의를 기울여야 합니다.

---

## 4. 기능 명세 (Feature Specifications)

### 4.1. 리스트 (DataTable)

- **조회 조건 설정 (FilterPanel)**
  - 공용 `FilterPanel` 컴포넌트 사용 (12-col 그리드, 칩 표시, 설정 초기화)
  - 필터 필드:
    1. **검색 항목** (Select): `차량 번호` / `분실물 카드` 선택
    2. **검색어** (Input): 선택한 검색 항목 기준 텍스트 검색
    3. **파트너 이름** (Select): 기본값 `전체`
    4. **처리 상태** (Select): 기본값 `전체`, 옵션: 배송지 미입력, 발송 대기, 발송 완료, 경찰서 인계, 폐기 완료
    5. **접수일 시작** (Date): 기본값 현재 기준 2개월 전
    6. **접수일 종료** (Date): 기본값 오늘

- **컬럼 (Columns)**
  1. **분실물 ID**: `id`
  2. **파트너 이름**: `partnerName`
  3. **차량 번호**: `carNumber`
  4. **존 이름**: `zoneName`
  5. **오더 ID**: `relatedOrderId` (클릭 시 해당 세차 오더 상세 페이지로 이동)
  6. **접수 일시**: `createdAt`
  7. **분실물 카드 번호**: `lostItemCardReceiptNumber` (값이 없으면 빈 칸으로 표시)
  8. **처리 상태**: `status` (Badge 적용)

- **정렬**: 컬럼 헤더 클릭 시 오름차순/내림차순 정렬 (기본: ID 내림차순)
- **페이지네이션**: 40건 단위 페이지네이션

### 4.2. 상세 조회 (Drawer)

- **Drawer 제목**: `"분실물 상세 정보"` / 부제: `"분실물 상세 및 처리 상태 관리"`
- **Footer**: `[닫기]` 버튼만 표시 (수정 버튼 없음)
- **인라인 편집**: 수정 가능한 필드는 처음부터 Select / Input / Textarea로 표시되며, 별도의 수정 모드 진입 없이 즉시 편집 가능합니다.

- **카드 섹션 구성**
  1.  **분실물 정보**
      - `분실물 ID` (수정 불가, 텍스트)
      - `접수 일시` (수정 불가, 텍스트)
      - `분실물 구분`: `Select` — 값 변경 시 컨펌 후 즉시 반영
      - `처리 상태`: `Select` — 현재 구분에 유효한 상태만 옵션 표시, 값 변경 시 컨펌 후 즉시 반영
      - `배송 주소`: 우편번호 검색(기본) / 직접 입력 라디오 선택, 주소1 + 주소2 입력 후 [저장] 버튼
      - `습득물 상세 정보`: `Textarea` + 개별 [저장] 버튼
      - `습득물 사진`: 사진 추가/삭제 즉시 반영

  2.  **차량 정보**
      - `차량 번호` (수정 불가)
      - `존 이름` (수정 불가)
      - `지역1` (수정 불가)
      - `지역2` (수정 불가)
      - `존 ID` (수정 불가)

  3.  **세차 오더 정보**
      - `파트너 이름` (수정 불가)
      - `연계 오더 ID`: `Input` + 개별 [저장] 버튼

  4.  **분실물 카드 정보 (옥스트라 연동)**
      - `카드 접수 번호` (수정 불가)

### 4.3. 인라인 편집 상세

#### Select 필드 (분실물 구분, 처리 상태)
- 항상 Select 컴포넌트로 표시 (종결 상태 제외)
- 값 변경 시 `confirm()` 다이얼로그로 확인 → 확인 시 즉시 items에 반영
- 처리 상태 Select의 option은 현재 `itemCategory`에 맞는 유효 상태만 표시

#### Input/Textarea 필드 (상세 정보, 연계 오더 ID)
- 항상 입력 필드로 표시
- 각 필드 옆에 개별 [저장] 버튼 제공
- 변경사항이 없으면 [저장] 버튼 비활성화 (disabled)
- 변경사항이 있으면 [저장] 버튼이 primary 색상으로 활성화

#### 배송 주소
- 분실물 정보 카드 내 처리 상태 하단에 위치
- 입력 모드 선택 (라디오): `우편번호 검색` (기본) / `직접 입력`
- **우편번호 검색 모드**: 주소1은 readOnly (Daum Postcode API 결과 자동 입력) + [주소 검색] 버튼, 주소2는 수동 입력
- **직접 입력 모드**: 주소1, 주소2 모두 수동 입력, [주소 검색] 버튼 숨김
- [저장] 버튼 클릭 시 주소1/주소2 모두 저장
- `일반` 아이템이 `배송지 미입력` 상태에서 주소1 저장 시 → `발송 대기`로 자동 전환

#### 습득물 사진
- 항상 추가/삭제 가능 (즉시 반영, 별도 [저장] 불필요)

---

## 5. 기술 가이드 (Tech Guide)

- **컴포넌트**: 공용 `ui.jsx` 컴포넌트를 사용합니다 (Card, CardHeader, CardTitle, CardContent, Button, Input, Select, Badge, Chip, FilterPanel, Drawer, Field, DataTable, usePagination).
- **Daum Postcode API**: `//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js` 동적 로드, `new daum.Postcode({ oncomplete }).open()` 패턴으로 주소 검색
- **모킹 (Mocking)**: '오더 ID' 검색 기능은 실제 API 연동 없이, 사용자 인터랙션이 가능한 수준의 프로토타입으로 구현합니다.
