# 오더 관리 기능 명세서

## 1. 개요
- **화면명**: 오더 관리
- **목적**: 세차 오더의 전체 생명주기(발행, 배정, 수행, 완료)를 관리하고 상세 정보를 모니터링합니다.
- **주요 기능**: 오더 목록 조회/필터링, 수기 오더 발행, 오더 상세 정보 및 타임라인 확인, 오더 수행 완료/삭제 처리.

---

## 2. 화면 구성 및 기능

### 2.1 검색 및 필터
상단 카드 영역에서 데이터를 필터링하며, 선택된 조건은 하단에 **칩(Chip)** 형태로 노출됩니다.

#### 검색 조건
| 구분 | 항목 | 타입 | 동작 정의 |
| :--- | :--- | :--- | :--- |
| **검색** | 검색항목 | 선택 | **옵션**: 차량 번호(기본값), 오더 ID, 존 이름, 수행원 |
| **검색** | 검색어 | 입력 | 선택한 항목에 해당하는 텍스트 부분 일치 검색 |
| **기간** | 발행일 | 날짜 선택 | 시작일 ~ 종료일 범위 조회 (기본값: 최근 1개월) |
| **필터** | 지역1 | 선택 | 변경 시 하위 **'지역2' 값 초기화** |
| **필터** | 지역2 | 선택 | 선택된 지역1에 속한 지역만 노출 |
| **필터** | 오더 구분 | 선택 | 긴급, 정규, 변경, 수시, 특별 |
| **필터** | 발행 유형 | 선택 | 위생장애, 주기세차, 수시세차 등 |
| **필터** | 세차 유형 | 선택 | 내외부, 내부, 외부, 특수, 협의, 라이트 |
| **필터** | 파트너 명 | 선택 | 파트너사 이름 기준 |
| **필터** | 파트너 유형 | 선택 | **[동적 로직]**<br>- 옵션: 전체, 현장, 입고<br>- 변경 시 **'진행 상태'** 필터의 옵션 목록이 해당 유형에 맞게 갱신됨.<br>*(예: 현장 선택 시 '입고 중', '출고 중' 상태 제외)* |
| **필터** | 진행 상태 | 선택 | 미배정, 예약, 수행 중, 완료, 취소 등 |

#### 동작 규칙
- **칩(Chip)**: 적용된 필터 조건이 칩으로 나열되며, `X` 버튼 클릭 시 해당 조건만 개별 초기화.
- **초기화 버튼**: 클릭 시 검색어, 기간(최근 1개월), 모든 필터 조건을 초기화하고 목록 갱신.
- **퀵 필터**: 외부 화면에서 특정 상태값을 전달받으면, 해당 상태가 필터에 자동 적용됨.

---

### 2.2 오더 목록
- **페이지네이션**: 페이지당 **40건** 기준.
- **정렬**: 헤더 클릭 시 오름차순/내림차순 정렬.
- **다운로드**: '목록 다운로드' 버튼 제공.

#### 컬럼 정의
| 헤더명 | 정렬 | 데이터 정의 및 로직 |
| :--- | :---: | :--- |
| 오더 ID | O | |
| 오더 구분 | O | |
| 발행 유형 | O | |
| 세차 유형 | O | |
| 차량 ID | O | |
| 차종 | O | |
| 차량 번호 | O | |
| 지역1 | O | |
| 지역2 | O | |
| 존 이름 | O | |
| 파트너 명 | O | |
| 파트너 유형 | O | 현장 / 입고 |
| 진행 상태 | O | 상태별 색상 배지 적용<br>- 완료: 초록색<br>- 미배정: 빨간색<br>- 예약/파트너 배정: 주황색<br>- 수행 관련 상태: 파란색 |
| 수행원 | O | |
| 발행 일시 | O | `YYYY-MM-DD HH:mm` 형식 |
| 수행 일시 | - | 상태가 [수행 중, 세차 완료, 출고 중, 완료]일 때만 노출. 그 외 `-` 표기 |

---

### 2.3 오더 수동 발행
'오더 발행' 버튼(+) 클릭 시 우측에서 패널이 열립니다.

#### 입력 항목
| 항목 | 필수 | 설명 |
| :--- | :---: | :--- |
| 차량 번호 | O | 입력 시 등록된 차량 정보를 실시간 조회하여 차종, 존 이름, 파트너 명을 자동 표기 |
| 오더 구분 | O | 긴급, 정규, 변경, 수시, 특별 중 선택 (기본값: 수시) |
| 발행 유형 | O | 위생장애, 주기세차, 수시세차 등 선택 (기본값: 수시세차) |
| 세차 유형 | O | 내외부, 내부, 외부, 특수, 협의, 라이트 중 선택 (기본값: 외부) |

#### 동작 규칙
- **차량 조회 실패**: 일치하는 차량이 없을 경우 "일치하는 차량 정보가 없습니다" 경고 메시지 노출.
- **미션 자동 연동**: 입력된 차량 번호에 **대기 상태의 미션**이 존재할 경우, 오더 생성 시 자동으로 포함됨.
  - **사용자 안내**: 차량 조회 성공 시, 연동될 미션이 있으면 "대기 중인 미션 N건이 함께 발행됩니다" 안내 문구 노출.
- **생성 기본값**:
  - 파트너 유형: **"현장"**으로 고정
  - 초기 상태: **"예약"**으로 생성
  - 수행원: 미지정 상태로 생성

---

### 2.4 오더 상세
목록의 행 클릭 시 우측 패널이 열리며, **탭** 구조로 상세 정보를 제공합니다.

#### 공통 액션 (하단 버튼 영역)
| 버튼 | 노출 조건 | 동작 |
| :--- | :--- | :--- |
| 수행 완료 | 상태가 [완료, 취소]가 **아닐 때** | 클릭 시 오더를 '완료' 처리하고, 연결된 미션도 함께 '완료' 상태로 변경 |
| 오더 삭제 | 항상 노출 | 클릭 시 **삭제 확인 팝업** 호출. 사유 입력 후 삭제 확정 |
| 닫기 | 항상 노출 | 패널 닫기 |

#### 탭 1: 상세정보

**기본 정보 영역**
| 항목 | 설명 |
| :--- | :--- |
| 오더 ID | 배지로 오더 구분(긴급 등)과 점검 유형(A/B/C/D) 함께 표시 |
| 차량 번호 / 차종 | |
| 존 이름 | |
| 지역 | 지역1 / 지역2 |
| 발행 유형 | |
| 세차 유형 | |
| 파트너 유형 | |
| 수행원 | |
| 진행 상태 | 상태별 색상 배지 적용 |
| 메모 | |

**시간 정보 영역**
| 항목 | 설명 |
| :--- | :--- |
| 발행 일시 | `YYYY-MM-DD HH:mm` 형식 |
| 수행 일시 | 상태가 [수행 중, 세차 완료, 출고 중, 완료]일 때만 노출. 그 외 `-` 표기 |

**금액 및 연계 정보 영역**
| 항목 | 설명 |
| :--- | :--- |
| 최종 청구 금액 | 금액 표시 및 '청구 내역' 바로가기 링크 |
| 연계 오더 | 입고 파트너 유형인 경우에만 노출. 부모 오더 ID 링크 |

---

#### 탭 2: 사진 및 점검
오더 수행 과정에서 기록된 모든 시각 자료와 점검 결과를 확인합니다.

**레이아웃 순서**: 진행 이력 → 세차 전 사진 → 세차 후 사진 → 점검 리스트 → 기타 사진

##### 2.4.1 진행 이력
파트너 유형에 따라 오더의 상태 변경 이력을 타임라인 형태로 표시합니다.

| 파트너 유형 | 상태 흐름 |
| :--- | :--- |
| 입고 | 미배정 → 파트너 배정 → 예약 → 입고 중 → 수행 중 → 세차 완료 → 출고 중 → 완료 |
| 현장 | 미배정 → 예약 → 수행 중 → 완료 |

##### 2.4.2 세차 전/후 사진
점검 유형에 따라 촬영된 사진 목록이 노출됩니다.

| 점검 유형 | 세차 전 사진 | 세차 후 사진 |
| :--- | :---: | :---: |
| A, B, C 유형 | O | O |
| D 유형 (라이트) | **X (미노출)** | O |

- 각 사진 썸네일 하단에 부위명(예: 전면, 운전석 등) 표시
- 썸네일 클릭 시 원본 크기 이미지를 팝업으로 표시

##### 2.4.3 점검 리스트
점검 유형(A/B/C/D)에 따라 수행된 점검 항목과 결과가 조회 전용으로 표시됩니다.

**점검 유형별 항목 구성**

| 점검 유형 | 포함 항목 |
| :--- | :--- |
| A 유형 | 공통 항목 12개 + A유형 전용 항목 (긴급 조치 내용, 시트 탈거, 부품교체 금액 등) |
| B 유형 | 공통 항목 12개 + B유형 전용 항목 |
| C 유형 | 공통 항목 12개 + C유형 전용 항목 |
| D 유형 (라이트) | 라이트 전용 항목만 표시 (외관 점검 부위, 외관 이상 유형, 오염도 등) |

**공통 점검 항목 (12개)**
- 적산거리, 타이어트레드, 유리창, 배터리전압, 안전삼각대, 차량용 소화기
- 워셔액통, 발판매트, 타이어파스/펑크, 시동불가, 본넷, 타이어마모

**항목별 표시 방식**
| 항목 특성 | 표시 방식 |
| :--- | :--- |
| 타이어 관련 (4개 부위) | 2x2 격자로 FL/FR/RL/RR 값 표시 |
| 다중 선택 항목 (외관 파손 등) | 선택된 값들을 개별 배지로 나열 |
| 단일 선택 항목 (배터리 상태 등) | 배지로 표시. '이상없음/완료'는 초록색, 그 외는 주황색 |
| 이상 발견 항목 | 값 옆에 빨간색 '이상' 배지 표시 + 증빙 사진 썸네일 노출 |

##### 2.4.4 기타 사진
점검 리스트 하단에 추가로 등록된 사진이 별도 섹션으로 표시됩니다.

---

#### 탭 3: 미션 및 분실물

**미션 영역**
- 오더에 연결된 미션 목록 표시 (미션 내용, 상태)
- 미션이 없으면 "등록된 미션이 없습니다" 문구 노출

**분실물 영역**
- 습득된 분실물 정보 표시: 물품명, 보관 상태, 습득 장소, 습득 일시
- 분실물이 없으면 "등록된 분실물이 없습니다" 문구 노출

---

## 3. 데이터 정의

### 3.1 점검 유형과 세차 유형 매핑
| 세차 유형 | 점검 유형 | 설명 |
| :--- | :---: | :--- |
| 내외부 | A | 전체 점검 + 전용 항목 |
| 내부 | B | 전체 점검 + 전용 항목 |
| 외부 | C | 전체 점검 + 전용 항목 |
| 특수 | A | 전체 점검 + 전용 항목 |
| 협의 | B | 전체 점검 + 전용 항목 |
| 라이트 | D | 라이트 전용 항목만 |

### 3.2 진행 상태 정의
| 상태 | 설명 | 배지 색상 |
| :--- | :--- | :--- |
| 미배정 | 오더 생성 후 파트너 미배정 | 빨간색 |
| 파트너 배정 | 파트너사에 배정됨 (입고 유형만) | 주황색 |
| 예약 | 수행 일정 확정 | 주황색 |
| 입고 중 | 차량이 세차장에 입고 중 (입고 유형만) | 파란색 |
| 수행 중 | 세차 작업 진행 중 | 파란색 |
| 세차 완료 | 세차 작업 완료 (입고 유형만) | 파란색 |
| 출고 중 | 차량 출고 진행 중 (입고 유형만) | 파란색 |
| 완료 | 모든 작업 완료 | 초록색 |
| 취소 | 오더 취소됨 | 회색 |

### 3.3 미션 연동 규칙
| 시점 | 동작 |
| :--- | :--- |
| 오더 발행 시 | 해당 차량의 '대기' 상태 미션이 오더에 자동 연결됨. 미션에 연결된 오더 ID와 배정 일시 기록. |
| 오더 완료 시 | 연결된 미션의 상태가 '완료'로 변경되고, 완료 일시 기록. |
| 오더 취소 시 | 연결된 미션의 오더 연결이 해제되고, 미션 상태는 '대기'로 복원. |