# 미션 정책 관리

## 1. 개요
- **화면명**: 미션 정책 관리
- **목적**: 반복되거나 대량으로 발생하는 특수 과업을 '정책'으로 정의하고, 해당 정책을 수행해야 할 차량들을 일괄 할당 및 관리하여 운영 효율성을 높입니다.
- **주요 구조**: `미션 정책(캠페인 단위)` - `할당 대상 차량`의 1:N 구조.
- **수행 방식**: 오더 발행 시 수행원에게 미션 노출 → 선택적 수행 → 완료 처리 시 상태 업데이트.

## 2. 화면 구성 및 기능

### 2.1 검색 및 필터 (Search & Filter)
상단 카드 영역에서 정책 리스트를 필터링하며, 선택된 조건은 하단에 **칩(Chip)** 형태로 노출됩니다.

#### 검색 조건
| 구분 | 항목 | 타입 | 동작 정의 |
| :--- | :--- | :--- | :--- |
| **기간** | 등록일 | DatePicker | 시작일 ~ 종료일 범위 조회 |
| **필터** | 상태 | 선택(Select) | **옵션**: 전체, 활성, 비활성 |

#### UI 동작
- **필터 칩**: 적용된 날짜 범위 및 상태 값이 칩으로 나열되며, `X` 버튼 클릭 시 해당 조건만 초기화.
- **필터 초기화**: 버튼 클릭 시 모든 입력값 및 칩을 제거하고 전체 목록 조회.

### 2.2 미션 정책 목록 (Main List)
등록된 미션 정책을 테이블 형태로 조회합니다.

- **페이지네이션**: 페이지당 **40건** 기준.
- **정렬**: 헤더 클릭 시 오름차순/내림차순 정렬 (기본값: ID 내림차순).
- **진입점**: '미션 정책 등록' 버튼 클릭 시 신규 등록 드로어 호출.

#### 컬럼 정의
| 헤더명 | 정렬 | 데이터 정의 및 로직 |
| :--- | :--- | :--- |
| **ID** | O | 정책 고유 식별자 |
| **미션 제목** | O | 정책의 제목 (`title` 필드, 없을 경우 `content` 필드 표시) |
| **금액** | O | 3자리 콤마 포맷 (`{금액}원`) |
| **대상 차량수** | O | **[파생 데이터]** 해당 정책에 할당된 전체 차량 수 (`{N}대`) |
| **수행 완료수** | O | **[파생 데이터]** 할당된 차량 중 상태가 'completed'인 차량 수 (`{N}대`) |
| **진행률(%)** | O | **[파생 데이터]** `(수행 완료수 / 대상 차량수) * 100` (반올림 처리) |
| **상태** | O | **[배지]** 활성(Green) / 비활성(Default) |
| **등록일시** | O | `yyyy-MM-dd hh:mm` 형식 |

### 2.3 신규 미션 정책 등록 (Drawer)
목록 상단의 '미션 정책 등록' 버튼(+) 클릭 시 호출됩니다.

#### 입력 필드
- **미션 제목**: 텍스트 입력 (최대 20자, 필수 항목).
- **미션 내용**: 여러 줄 텍스트 입력(Textarea, 최대 500자).
- **미션 금액**: 숫자 입력 (최소 0원).
- **상태**: 활성 / 비활성 선택 (기본값: 활성).
- **옵션**: "수행 시 증빙 사진 필수" 체크박스 (Boolean).

### 2.4 정책 상세 및 차량 관리 (Drawer)
목록의 행(Row) 클릭 시 우측 드로어가 열립니다.

#### A. 정책 정보 섹션
- **타이틀**: "정책 정보"
- **읽기 전용 필드**: 미션 제목, 미션 내용, 미션 금액, 등록일시, 수행 시 증빙 사진 필수 여부는 등록 이후 **수정 불가** (Read-only, Disabled UI 스타일).
- **상태 변경**: 상태(활성/비활성) 셀렉트만 변경 가능.
  - **활성 → 비활성**: **"비활성 상태로 전환 시, 대기 중인 차량 목록이 모두 삭제됩니다. 상태를 변경하시겠습니까?"** 컨펌 후 (1) 상태 변경, (2) 대기 중인 차량 목록 일괄 삭제.
  - **비활성 → 활성**: **"정책 상태를 정말 변경할까요?"** 컨펌 후 상태 변경.

#### B. 정책 삭제
- **[정책 삭제]** 버튼은 Drawer 하단 Footer에 위치.
- **삭제 가능 조건**: 할당된 차량 목록에 데이터가 **없는 경우**에만 활성화.
- **삭제 불가 조건**: 할당된 차량이 존재하면 버튼 비활성(disabled) 처리.
  - 완료된 차량이 있는 경우: 완료 차량은 삭제할 수 없으므로 정책 삭제 불가.
  - 완료된 차량이 없는 경우: '대기 차량 전체 삭제'로 모든 차량 제거 후 정책 삭제 가능.
- 삭제 실행 시 **"정말로 이 정책을 삭제하시겠습니까?"** 컨펌(Confirm) 후 처리.

#### C. 대상 차량 관리 섹션

**1. 차량 일괄 추가 (Bulk Input)**
- **입력 방식**: 텍스트 영역(Textarea)에 차량 번호 입력.
- **구분자 로직**: **콤마(,)** 또는 **줄바꿈(Enter)**을 기준으로 텍스트를 분리하여 다수의 차량을 한 번에 목록에 추가.
- **초기 상태**: 추가된 차량의 수행 상태는 '대기(pending)'로 설정됨.

**2. 할당 차량 검색 (Search Assigned Vehicles)**
- **입력 방식**: 텍스트 영역(Textarea)에 검색할 차량 번호 입력.
- **구분자 로직**: **콤마(,)** 또는 **줄바꿈(Enter)**을 기준으로 여러 차량 번호를 동시에 검색 가능.
- **동작**: 입력된 차량 번호와 일치하는 차량만 아래의 '할당된 차량 목록'에 필터링하여 표시.

**3. 대기 차량 전체 삭제**
- 할당된 차량 목록 표 우측 상단에 **[대기 차량 전체 삭제]** 버튼 제공.
- 대기 상태 차량이 존재하는 경우에만 노출.
- 클릭 시 **"대기 상태 차량 N대를 모두 삭제하시겠습니까?"** 컨펌 후 일괄 삭제.

**4. 할당된 차량 목록 (Table)**
- **헤더**: "할당된 차량 목록 ({완료 차량수} / {할당 차량 총수}대)" + 진행률(%) 배지 표시
- **페이지네이션**: 페이지당 **100건** 기준.
- **차량 번호**: 대상 차량 번호.
- **수행 상태**: **[배지]** 완료(Green) / 대기(Orange).
- **연결된 오더**:
  - 수행 완료 시: 오더 ID 노출 및 링크(새 창 이동).
  - 미완료 시: `-` 표기.
- **완료일**: `YYYY-MM-DD` 형식.
- **관리(Actions)**: 상태가 '대기'인 경우에만 **삭제(Trash Icon)** 버튼 노출. 클릭 시 **"선택한 차량을 삭제하시겠습니까?"** 컨펌 후 삭제.

## 3. 데이터 정책

### 3.1 오더 연동 정책
- **자동 포함**: 특정 차량에 대해 세차 오더가 발행될 때, 해당 차량 번호가 할당된 '대기' 상태의 미션 정책이 있다면 오더의 미션 목록에 자동으로 포함됩니다.
- **선택적 수행**: 수행원은 오더 수행 중 연결된 미션을 확인하고 선택적으로 처리합니다. 미션 수행은 강제되지 않습니다.
- **상태 동기화**: 수행원이 미션을 수행 완료 처리하면, 해당 정책 하위의 차량 수행 상태가 '완료'로 자동 업데이트됩니다.
- **진행률 갱신**: 차량의 상태 변경 시, 정책 목록의 진행률 및 수행 완료수도 즉시 재계산되어야 합니다.

### 3.2 비활성 전환 시 기발행 오더 처리 정책

정책이 **활성 → 비활성**으로 전환될 때, 이미 발행된 오더에 연동된 미션의 처리 방식을 정의합니다.

#### 전제 조건
- 미션 정책이 '활성' 상태일 때 오더가 발행되어 수행원에게 미션이 노출된 상태.
- 수행원이 해당 미션을 아직 완료하지 않은 시점에 관리자가 정책을 '비활성'으로 변경.

#### 정책: 기발행 오더 유지
- **적용 시점 기준**: 비활성화 시점 **이후** 새로 생성되는 오더부터 미션 노출을 중단합니다.
- **기발행 오더**: 비활성화 이전에 이미 발행된 오더에 포함된 미션은 **그대로 유지**하며, 수행원이 정상적으로 수행·완료 처리할 수 있습니다.
- **완료 처리**: 기발행 오더에서 미션이 완료되면, 해당 차량의 수행 상태는 기존 로직대로 '완료'로 업데이트됩니다.

#### 운영 참고 사항
- 비활성화 후에도 기발행 오더가 소진될 때까지 미션 수행 및 관련 비용이 발생할 수 있습니다.
- 수행원 관점에서 이미 노출된 미션이 갑자기 사라지지 않으므로 현장 혼란을 방지합니다.