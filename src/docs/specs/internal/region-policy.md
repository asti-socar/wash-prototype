# 지역 정책 관리

## 1. 개요
- **화면명**: 지역 정책 관리
- **목적**: 시/도(Region1) 및 시군구(Region2) 단위의 공통 세차 정책을 설정. 존에 개별 정책이 없으면 해당 지역 정책이 기본값으로 적용.
- **주요 기능**: 지역1/지역2 정책 탭 분리 조회, 행별 인라인 수정/삭제, 변경 이력 Drawer, 일괄 수정(지역2)

## 2. 데이터

### 2.1 정책 계층 구조
```
지역1 정책(시도) ← 기본 정책
  └── 지역2 정책(시군구) ← 개별 정책 (선택적)
```
- **지역1 정책**: 시/도 단위 기본 정책. 전체 17개 시도에 대해 반드시 존재.
- **지역2 정책**: 시군구 단위 개별 정책. **없는 경우 해당 시군구는 소속 시도의 지역1 정책을 따름.**
- 지역1과 지역2 정책은 독립적으로 관리.

### 2.2 Mock 데이터
| 파일 | 건수 | 설명 |
| :--- | :---: | :--- |
| `region1policy.json` | 17건 | 시/도 단위 정책 (전체 시도) |
| `region2policy.json` | 229건 | 시군구 단위 정책 (한국 전체 시군구) |

### 2.3 지역1 정책 데이터 구조
| 필드명 | 타입 | 설명 | 예시 |
| :--- | :---: | :--- | :--- |
| Region1ID | string | 지역1 고유 식별자 | "R1-01" |
| 시도 | string | 시/도 명칭 | "서울" |
| 주기세차(일) | number | 주기세차 오더 발행 기준 일수 | 14 |
| 라이트세차 | string | 라이트세차 적용 여부 (Y/N) | "Y" |

### 2.4 지역2 정책 데이터 구조
| 필드명 | 타입 | 설명 | 예시 |
| :--- | :---: | :--- | :--- |
| Region2ID | string | 지역2 고유 식별자 | "R2-001" |
| 시도 | string | 소속 시/도 명칭 | "서울" |
| 시군구 | string | 시군구 명칭 | "강남구" |
| 주기세차(일) | number \| null | 주기세차 기준 일수. **null = 상위 정책(시도) 따름** | 14 또는 null |
| 라이트세차 | string \| null | 라이트세차 적용 여부. **null = 상위 정책(시도) 따름** | "Y" 또는 null |

- 두 필드 모두 `null`이면 해당 시군구는 소속 시도의 지역1 정책을 전부 따름
- 개별 필드 단위로 `null` 설정 가능 (주기세차만 상위 따름, 라이트세차는 직접 설정 등)

---

## 3. 화면 구성 및 기능

### 3.1 탭 구성
| 탭 | value | 설명 |
| :--- | :--- | :--- |
| 지역1 정책(시도) | `region1` | 시/도 단위 정책 목록 (기본 탭) |
| 지역2 정책(시군구) | `region2` | 시군구 단위 정책 목록 |

- **독립 관리**: 지역1과 지역2는 각각 별도의 컴포넌트(`Region1Tab`, `Region2Tab`)로 분리되어 독립적으로 상태 관리
- **CSS 기반 탭 전환**: `display: block/none`으로 전환하여 양쪽 탭이 항상 마운트 상태 유지 → 탭 전환 시 상태 보존
- `TabsContent` 미사용 (비활성 탭 unmount 방지)

---

### 3.2 행별 인라인 수정

#### 수정 진입
- 각 행 우측에 **연필 아이콘** (`<Pencil>`) + **삭제 아이콘** (`<Trash2>`, 지역2만) 표시
- 연필 아이콘 클릭 시 해당 행의 주기세차(일)과 라이트세차가 Input/Select로 전환
- 한 번에 하나의 행만 수정 가능 (다른 행 수정 클릭 시 기존 편집 대체)

#### 정책 삭제 (지역2 전용)
- **삭제 아이콘** (`<Trash2>`): 주기세차(일)과 라이트세차를 동시에 null로 설정
- 이미 두 필드 모두 null인 경우 삭제 버튼 비활성 (`opacity-30`)
- 삭제 시 변경된 필드만 이력에 기록 (from → null)

#### 저장 조건 — 지역1
- **두 필드 모두 유효한 값이 있어야 저장 버튼 활성화**
  - 주기세차(일): 7~30 범위의 숫자
  - 라이트세차: Y 또는 N

#### 저장 조건 — 지역2 (상위 정책 따름 허용)
- 주기세차(일): **빈 값 또는 0** = 상위 정책 따름 (null로 저장), 7~30 범위의 숫자 = 직접 설정
- 라이트세차: **"선택안함 (상위 정책 따름)"** 선택 시 null로 저장, Y/N = 직접 설정
- 유효하지 않은 값(1~6 등)이면 저장 버튼 비활성

#### 공통
- 값에 실제 변경이 없으면 이력 미기록, 편집 모드만 종료

#### 키보드 지원
- **Enter**: 주기세차(일) Input에서 Enter 시 저장 (유효한 경우)
- **Escape**: 편집 취소

#### 저장 처리
- [저장] 클릭 → 데이터 즉시 반영 (행 단위 개별 저장)
- 변경된 필드만 이력에 기록 (from/to)
- null 값은 이력에 "없음"으로 표시

---

### 3.3 변경 이력 Drawer (지역1/2 공통)

공유 `HistoryDrawer` 컴포넌트로 양쪽 탭에서 동일한 UI 제공.

#### 진입
- 정책 ID(Region1ID / Region2ID) 클릭 시 오른쪽 Drawer 열림 (파란색 링크)

#### Drawer 구성
- **제목**: `{시도} 정책 변경 이력` (지역1) / `{시도} {시군구} 정책 변경 이력` (지역2)
- **부제**: `ID: {정책ID}`
- **Footer**: [닫기] 버튼

#### 카드 1: 현재 정책
| 필드 | 지역1 | 지역2 |
| :--- | :--- | :--- |
| 정책 ID | O | O |
| 시도 | O | O |
| 시군구 | - | O |
| 주기세차(일) | N일 | N일 또는 "없음" (gray) |
| 라이트세차 | Badge (ok/default) | Badge (ok/default) 또는 "없음" (gray) |

- 최신 데이터 반영 (수정 후 Drawer 열면 변경된 값 표시)

#### 카드 2: 변경 이력
- 최신순 역시간순 표시
- 타임라인 스타일: `border-l-4 border-blue-500`
  - 헤더: 일시 (ko-KR locale) · 수정자
  - 변경 목록: 필드명 + from(rose) → to(emerald) 색상 표시. null 값은 "없음"으로 표시
- 이력 없을 시: "변경 이력이 없습니다." 안내

#### Mock 이력 데이터
- `INITIAL_R1_HISTORY`: R1-01, R1-02, R1-04, R1-07, R1-16에 초기 이력
- `INITIAL_R2_HISTORY`: R2-001, R2-010, R2-025, R2-050에 초기 이력
- 세션 중 수정 시 이력 자동 추가 (user: "Ops Admin")
- 일괄 수정 시 이력 자동 추가 (user: "Ops Admin (일괄)")

---

### 3.4 지역1 정책(시도) 탭

#### 3.4.1 목록 조회
- 페이지네이션 없이 전체 17건 노출
- 기본 정렬: 없음 (Mock 데이터 순서 유지)
- 상단: 전체 N건 표시

#### 3.4.2 컬럼
| 헤더명 | key | 정렬 | 비고 |
| :--- | :--- | :---: | :--- |
| ID | Region1ID | | 클릭 시 Drawer 열림 (파란색 링크) |
| 시도 | 시도 | | 읽기 전용 |
| 주기세차(일) | 주기세차(일) | O | 수정 모드: `<Input type="number">` (w-24, 7~30) |
| 라이트세차 | 라이트세차 | | 수정 모드: `<Select>` Y/N (w-20). 읽기 모드: Badge |
| (액션) | _actions | | 연필 아이콘 / 저장·취소 버튼 |

#### 3.4.3 정렬
- **정렬 가능 컬럼**: 주기세차(일) 1개만
- 헤더 클릭 시 오름차순/내림차순 토글

---

### 3.5 지역2 정책(시군구) 탭

#### 3.5.1 FilterPanel
| 필드 | 컴포넌트 | Grid Span | 설명 |
| :--- | :--- | :---: | :--- |
| 시도 | `<Select>` | col-span-2 | 기본값 "전체". 선택 시 해당 시도의 시군구만 표시 |
| 시군구 검색 | `<Input>` | col-span-4 | placeholder: "시군구 검색 (쉼표/공백으로 구분)" |

- 적용된 필터는 Chip으로 표시 + 설정 초기화 버튼
- 필터 변경 시 페이지를 1로 리셋
- 시도 필터와 검색은 AND 조건 동시 적용

#### 3.5.2 컬럼
| 헤더명 | key | 정렬 | 비고 |
| :--- | :--- | :---: | :--- |
| (체크박스) | _select | | 헤더: 현재 페이지 전체선택/해제 (indeterminate 지원). 행: 개별 선택 |
| ID | Region2ID | | 클릭 시 Drawer 열림 (파란색 링크) |
| 시도 | 시도 | | 파란색 링크. hover 시 지역1 정책 툴팁 표시, 클릭 시 지역1 탭 이동 |
| 시군구 | 시군구 | | 읽기 전용 |
| 주기세차(일) | 주기세차(일) | O | 수정 모드: `<Input type="number">` (w-24, min=0 max=30, placeholder="0: 상위"). null 시 "없음" (gray) |
| 라이트세차 | 라이트세차 | | 수정 모드: `<Select>` (w-44) "선택안함 (상위 정책 따름)"/Y/N. null 시 "없음" (gray) |
| (액션) | _actions | | 연필 아이콘 + 삭제 아이콘 / 수정 모드: 저장·취소 버튼 |

#### 3.5.3 시도 필드 인터랙션
- **hover**: 해당 시도의 지역1 정책을 툴팁으로 표시 (주기세차(일), 라이트세차)
  - `group-hover/sido` 기반 CSS 툴팁, `initialRegion1Data` 참조
- **클릭**: `onSwitchTab("region1")` 호출 → 지역1 정책 탭으로 전환

#### 3.5.4 정렬
- **정렬 가능 컬럼**: 주기세차(일) 1개만

#### 3.5.5 페이지네이션
- **페이지 크기**: 50건 (PER_PAGE = 50)
- 수동 페이지네이션 (usePagination 미사용)
- 전체 페이지 수가 1 이상일 때만 Pagination 컴포넌트 노출

#### 3.5.6 행 선택 + 일괄 수정 (Batch Edit)

##### 행 선택
- 각 행 좌측에 **체크박스** 표시
- **헤더 체크박스**: 현재 페이지 전체 선택/해제. 일부만 선택 시 `indeterminate` 상태
- **선택 상태**: `selectedIds` (Set) — 페이지 전환/필터 변경에도 선택 유지
- 선택 건수 표시: 일괄 수정 버튼 좌측에 "N건 선택" (파란색)

##### 일괄 수정
- **활성 조건**: 1건 이상 선택 시 버튼 활성
- **버튼**: "일괄 수정 (N건)" — `<Edit>` 아이콘 포함
- **모달 (BatchEditModal)**:
  - 제목: "필터된 데이터 일괄 수정"
  - 주기세차(일): `<Input type="number">` min=0 max=30, placeholder="0: 상위 정책 따름, 7~30: 직접 설정"
  - 라이트세차: `<Select>` "변경 안함"/"상위 정책 따름"/Y/N
    - **"변경 안함"** (value=""): 해당 필드 미변경
    - **"상위 정책 따름"** (value="inherit"): null로 설정
  - 빈 값 = 미변경, 두 필드 모두 빈 값이면 적용 버튼 비활성
- **적용 시**: 선택된 행만 대상, 데이터 즉시 반영 + 실제 변경된 행만 이력 자동 기록 (user: "Ops Admin (일괄)")
  - 주기세차(일) 0 → null 변환, 라이트세차 "inherit" → null 변환
  - 적용 완료 시 선택 초기화

#### 3.5.7 건수 표시
- 필터 미적용 시: "전체 N건"
- 필터 적용 시: "필터 결과 N건 / 전체 M건"

---

## 4. 데이터 처리 흐름

### 4.1 행별 수정 흐름

#### 지역1 (7~30, Y/N 필수)
```
연필 아이콘 클릭 → editingRowId 설정 + editValues 초기화
  → Input/Select 전환 → 사용자 값 변경
  → [저장] 클릭 → 변경된 필드만 비교
  → 변경 있으면: data 업데이트 + history에 이력 추가
  → 변경 없으면: 편집 모드만 종료
```

#### 지역2 (null 허용)
```
연필 아이콘 클릭 → editingRowId 설정 + editValues 초기화 (null → "" 변환)
  → Input/Select 전환 → 사용자 값 변경
  → [저장] 클릭 → 빈 값/0 → null 변환 → 변경된 필드만 비교
  → 변경 있으면: data 업데이트 + history에 이력 추가
  → 변경 없으면: 편집 모드만 종료
```

### 4.2 정책 삭제 흐름 (지역2)
```
삭제 아이콘 클릭 → 두 필드 모두 null인지 확인
  → 변경된 필드만 changes 객체에 기록 (from → null)
  → data 업데이트 (주기세차(일)=null, 라이트세차=null)
  → history에 이력 추가 (user: "Ops Admin")
```

### 4.3 지역2 필터링·정렬·페이지네이션 순서
```
data (전체 229건)
  → filter.sido 적용 (시도 필터)
  → filter.search 적용 (시군구 검색, OR 조건)
  → filtered
  → sortConfig 적용 (주기세차(일) 정렬)
  → sortedData
  → 수동 페이지네이션 (50건 단위)
  → pageData (화면 표시)
```

### 4.4 일괄 수정 흐름
```
체크박스로 행 선택 → [일괄 수정] → BatchEditModal
  → 사용자 값 입력 → [N건에 적용]
  → 주기세차(일) 0 → null, 라이트세차 "inherit" → null 변환
  → selectedIds 기반 대상 행별 변경 계산
  → 실제 변경된 행만 history에 이력 추가 (user: "Ops Admin (일괄)")
  → data 업데이트 → selectedIds 초기화 → 모달 닫기
```

---

## 5. UI 컴포넌트 의존성
| 컴포넌트 | 용도 |
| :--- | :--- |
| Tabs / TabsList / TabsTrigger | 지역1/지역2 탭 전환 (TabsContent 미사용) |
| DataTable | 테이블 렌더링 (정렬 지원) |
| Badge | 라이트세차 Y/N 표시 (tone: ok/default) |
| Button | 저장/취소/일괄 수정 버튼 |
| Input | 주기세차(일) 편집, 시군구 검색 |
| Select | 라이트세차 편집, 시도 필터 |
| Pagination | 지역2 탭 페이지네이션 |
| FilterPanel / Chip | 지역2 탭 필터 패널 |
| Drawer / Field | 변경 이력 Drawer (HistoryDrawer) |
| Card / CardHeader / CardTitle / CardContent | Drawer 카드, BatchEditModal |

## 6. Badge 색상 규칙
| 값 | tone | 색상 |
| :--- | :--- | :--- |
| Y | ok | 녹색 (emerald) |
| N | default | 회색 (slate) |

## 7. null 값 표시 규칙 (지역2 전용)
- 주기세차(일), 라이트세차 모두 동일 스타일: `text-sm text-[#6B778C]` (연한 회색, 기울기 없음)
- 테이블/Drawer/이력에서 null → **"없음"** 텍스트로 표시
