# 발행 유형 정책 관리

## 1. 개요
- **화면명**: 발행 유형 정책 관리
- **목적**: 세차 오더 발행 유형별 정책(중요도 점수, 블락 시간, 파트너 유형 등)을 등록·수정하고 중요도 순위를 관리
- **주요 기능**: 정책 목록 조회/정렬, 정책 등록/수정(Drawer), 중요도 순위 자동 계산, 변경 이력 관리

## 2. 데이터 정책

### 2.1 중요도 총점 산출
사용자 항목 선택/입력 시 실시간 계산하여 표시합니다.

**공식**: `(세차유형점수 × 10000) + (오더구분점수 × 1000) + (발행유형점수 × 100) + (가산점 × 10) + 존유형점수`

| 항목 | 점수 매핑 |
| :--- | :--- |
| 세차 유형 | 협의(8), 특수(7), 내외부(5), 내부(4), 외부(3), 물세차(2), 라이트(1) |
| 오더 구분 | 변경(9), 수시(8), 긴급(7), 정규(5), 특별(3) |
| 존 유형 | 일반존(8), 주기세차존(6), 시승존(5), 캠핑카(5), 현장세차 불가존(4) |

- **순위**: 전체 정책의 총점 내림차순으로 자동 산출. 데이터 추가/수정 시 전체 순위 재계산.

### 2.2 파트너 유형 자동 결정
운영자 수기 선택 불가. 아래 조건에 따라 시스템이 자동 판단합니다.
- **입고**: 존유형이 `현장세차 불가존`이거나, 세차 유형이 `특수` 또는 `협의`
- **현장**: 위 조건에 해당하지 않는 모든 경우

### 2.3 블락 시간 자동 합산
- **입력 항목**: 쿠션(전), 핸들러(배차), 세차수행시간, 쿠션(후), 핸들러(반차)
- **총 블락 시간**: 5개 항목의 합계 (분 단위, 읽기 전용)

### 2.4 버전 관리
- 저장 시 `version` +1 자동 증가
- 수정 일시, 수정자 ID, 변경 내역(필드별 From/To)을 `history`에 기록

---

## 3. 화면 구성 및 기능

### 3.1 리스트
- **노출 방식**: 페이지네이션 없이 전체 노출, 세로 스크롤. 고정 헤더(Sticky).
- **기본 정렬**: 발행 유형 ID 오름차순. **전체 컬럼** 헤더 클릭 시 오름차순/내림차순 토글. 정렬 가능 컬럼은 헤더에 화살표 아이콘(↕)으로 표시.
- **엑셀 다운로드**: 현재 리스트 데이터 CSV 파일 추출
- **건수 표시**: 리스트 상단에 전체 N건 표시

#### 컬럼
| 헤더명 | 정렬 | Badge | 비고 |
| :--- | :---: | :---: | :--- |
| 정책 ID | O | | 중앙 정렬 |
| 순위 | O | | 중앙 정렬 |
| 오더 구분 | O | | |
| 발행 유형 | O | | |
| 세차 유형 | O | | |
| 존유형 | O | | |
| 블락시간 | O | | 중앙 정렬, `N분` 형식 |
| 발행여부 | O | Y=ok, N=danger | 중앙 정렬 |
| 파트너 유형 | O | default | |

### 3.2 상세/등록 (Drawer)
행 클릭 시 상세 조회(읽기 모드), [수정하기] 클릭 시 편집 모드 전환. 신규 등록과 수정을 하나의 Drawer에서 처리.

- **Drawer 제목**: 신규 등록 시 `발행 유형 추가`, 수정 시 `[ID: {id}] 발행 유형 정책 수정`
- **Footer**: 좌측 버전 표시(`Version: N`, 수정 모드만), 우측 버튼
  - 읽기 모드: [닫기] [수정하기]
  - 편집 모드: [취소] [저장하기/추가하기]

#### 탭 구성
1. **상세 정보**: 정책 필드 입력 및 자동 계산 결과 확인
2. **변경 이력**: 수정 시점, 수정자, 변경 내역(From/To) 역순 표시 (신규 등록 시 탭 미노출)
3. **API 상세**: 백엔드/AI 모델 통신용 JSON 스키마 예시

#### 상세 정보 탭 구성

**헤더 영역** (읽기 전용)
- 발행 유형 명칭 (order_type_name) — 큰 글씨 bold
- 설명 (description) — 작은 글씨 회색

**카드 1: 기본 정보**

| 필드 | 타입 | 툴팁 | 비고 |
| :--- | :--- | :---: | :--- |
| 셰어링 유형 | Select (단기/시승) | | |
| 오더 구분 | Select (정규/변경/수시/특별/긴급) | O | 점수 매핑표 |
| 세차 유형 | Select (협의/특수/내외부/내부/외부/물세차/라이트) | O | 점수 매핑표 |
| 존유형 | Select (일반존/주기세차존/현장세차 불가존/시승존/캠핑카) | O | 점수 매핑표 |
| 파트너 유형 | ReadOnly | O | 자동 결정 (§2.2) |
| 오더발행 여부 | Select (Y/N) | | |

**카드 2: 오더 중요도** (배경색 `#F0F7FF`)

| 필드 | 타입 | 툴팁 | 비고 |
| :--- | :--- | :---: | :--- |
| 발행 유형 점수 | Input (number, 1~9) | O | 편집 가능 |
| 가산점 | Input (number, 기본값 0) | O | 편집 가능 |
| 세차 유형 점수 | ReadOnly | | 자동 계산 |
| 오더 구분 점수 | ReadOnly | | 자동 계산 |
| 존유형 점수 | ReadOnly | | 자동 계산 |
| 중요도 총점 | ReadOnly | O | 공식 표시 |
| 순위 (Rank) | ReadOnly | | `N 위` 형식 |

**카드 3: 블락 정책**

| 필드 | 타입 | 툴팁 | 비고 |
| :--- | :--- | :---: | :--- |
| 블락 유형 | Select (없음/세차블락/장애블락) | | |
| 총 블락 시간 | ReadOnly | O | 합산 공식 표시, `N분` 형식 |
| 쿠션(전) | Input (number) | | 분 단위 |
| 핸들러(배차) | Input (number) | | 분 단위 |
| 세차수행시간 | Input (number) | | 분 단위 |
| 쿠션(후) | Input (number) | | 분 단위 |
| 핸들러(반차) | Input (number) | | 분 단위 |

**카드 4: 부가 정책**

| 필드 | 타입 | 툴팁 | 비고 |
| :--- | :--- | :---: | :--- |
| 미션등록 여부 | Select (Y/N) | | |
| 유예 면제 여부 | Select (Y/N) | O | 긴급 시 유예 시간 무시 |
| 오더 발행 유예 시간 | Input (number) | O | 시간 단위 |
| 자동 배정 | Select (Y/N) | O | Y 선택 시 하위 필드 활성화 |
| 반복 주기 | Select (1주~16주) | O | 자동 배정=Y 시만 편집 가능. 1주=반복 없음 |
| 수행 시간 | Input (time) | | 자동 배정=Y 시만 편집 가능 |
| 수행 요일 | 요일 버튼 다중선택 (월~일) | | 자동 배정=Y 시만 편집 가능. 전체 선택 시 '매일' 표시 |

**메모** (전체 너비)
- Textarea, 최대 200자

#### 유효성 검사
- 발행 유형 명칭 필수 입력
- 발행 유형 명칭 중복 여부 전체 리스트 확인 (신규 등록 시)
- 발행 유형 점수 1~9 범위
- 동일 오더 구분 내 발행 유형 점수 중복 확인 (신규 등록 시)
- 메모 200자 이내
