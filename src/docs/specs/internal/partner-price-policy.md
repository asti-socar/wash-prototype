# 파트너 단가 정책 관리 기능 명세서

## 1. 개요
- **화면명**: 단가 정책 관리
- **메뉴 위치**: 파트너 관리 > 파트너 상세 > 단가 정책 관리 탭
- **목적**: 파트너별 오더 단가 정책을 관리합니다. 적용 시작일을 지정하여 현재 적용 중인 정책과 미래 적용 예정 정책을 분리 관리할 수 있습니다.
- **주요 기능**: 단가 정책 조회, 정책 추가(적용 시작일 지정), 정책 삭제.

---

## 2. 화면 구성 및 기능

### 2.1 적용 중 단가 정책
오늘 날짜 기준 **적용 시작일이 오늘 이하**인 정책을 표시합니다.

#### 컬럼 정의
| 헤더명 | 데이터 정의 |
| :--- | :--- |
| **오더 구분** | 긴급, 정규, 변경, 수시, 특별 |
| **세차 유형** | 내외부, 내부, 외부, 특수, 협의, 라이트, 기계세차 |
| **단가** | 금액 (원 단위, 천단위 콤마 표시) |
| **적용 시작일** | YYYY-MM-DD 형식 |
| **관리** | 삭제 버튼 (휴지통 아이콘) |

### 2.2 예정된 단가 정책
오늘 날짜 기준 **적용 시작일이 내일 이후**인 정책을 표시합니다.

- 컬럼 구성은 적용 중 단가 정책과 동일
- 적용 시작일 기준 오름차순 정렬

### 2.3 정책 추가
새로운 단가 정책을 등록합니다.

#### 입력 필드
| 필드명 | 타입 | 옵션 | 기본값 |
| :--- | :--- | :--- | :--- |
| **오더 구분** | Select | 긴급, 정규, 변경, 수시, 특별 | 긴급 |
| **세차 유형** | Select | 내외부, 내부, 외부, 특수, 협의, 라이트, 기계세차 | 내외부 |
| **단가** | Number Input | - | 0 |
| **적용 시작일** | Date Input | - | 오늘 날짜 |

#### 추가 로직
1. `+` 버튼 클릭
2. 유효성 검사: 단가 > 0, 적용 시작일 필수
3. 확인 다이얼로그: "정책을 추가할까요?"
4. 확인 시 정책 목록에 추가

---

## 3. 비즈니스 로직

### 3.1 정책 분류 기준
```
오늘 날짜 (today) 기준:
- effectiveDate <= today → "적용 중 단가 정책" 영역에 표시
- effectiveDate > today  → "예정된 단가 정책" 영역에 표시
```

### 3.2 정렬 규칙
- **적용 중**: 적용 시작일 내림차순 (최근 적용 정책 우선)
- **예정**: 적용 시작일 오름차순 (빠른 적용 예정 정책 우선)

### 3.3 정책 삭제
1. 휴지통 아이콘 클릭
2. 확인 다이얼로그: "정책을 삭제할까요?"
3. 확인 시 해당 정책 삭제

### 3.4 동일 조합 정책 처리

#### 정책 활성화 규칙
동일한 파트너 내에서 **동일한 (오더 구분 + 세차 유형)** 조합의 정책이 복수 존재할 경우:

1. **새 정책 적용 시작일 도래 시**: 해당 조합의 과거 정책은 **비활성화(Soft Delete)** 처리
2. **비활성화된 정책**: 화면에 표시되지 않음 (DB에는 이력으로 보관)
3. **활성 정책만 표시**: 각 조합별로 현재 유효한 정책 1건만 "적용 중" 영역에 노출

#### 예시 시나리오
```
파트너: 강남모빌리티
오더 구분: 정규
세차 유형: 내외부

등록된 정책:
- 정책 A: 15,000원, 적용 시작일 2025-01-01 → 비활성화 (화면 미노출)
- 정책 B: 17,000원, 적용 시작일 2026-02-01 → 적용 중 (현재 활성)
- 정책 C: 20,000원, 적용 시작일 2026-05-01 → 예정 (미래)

오늘 날짜: 2026-02-03
- 정책 B의 적용 시작일(2026-02-01)이 도래하면서 정책 A는 자동 비활성화
- 화면에는 정책 B(적용 중), 정책 C(예정)만 표시
```

#### 비활성화 처리 방식
- **Soft Delete**: 물리적 삭제가 아닌 `isActive: false` 플래그 처리
- **이력 보관 목적**: 과거 단가 변경 이력 추적 및 정산 검증에 활용
- **자동 처리**: 적용 시작일 기준으로 시스템이 자동 비활성화 수행

---

## 4. 데이터 모델

### 단가 정책 데이터 구조
```javascript
{
  id: 1,                      // 정책 ID (자동 생성)
  orderGroup: "정규",         // 오더 구분
  washType: "내외부",         // 세차 유형
  price: 15000,              // 단가 (원)
  effectiveDate: "2025-01-01" // 적용 시작일
}
```

---

## 5. UI/UX 가이드

### 5.1 드로어 Footer
- 단가 정책 관리 탭 선택 시 하단에 **[닫기]** 버튼만 표시
- [수정하기] 버튼은 숨김 처리 (정책 추가/삭제는 인라인으로 처리)

### 5.2 빈 상태 처리
- **적용 중 정책 없음**: "적용 중인 정책이 없습니다."
- **예정된 정책 없음**: "예정된 정책이 없습니다."

### 5.3 확인 다이얼로그
- 정책 추가/삭제 시 `window.confirm()` 다이얼로그로 사용자 확인
